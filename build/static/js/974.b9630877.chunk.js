"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[974],{9974:(e,t,a)=>{a.r(t),a.d(t,{default:()=>b});var n=a(1783),s=a(4417),i=a(914),o=a(8170),l=a(5043),r=(a(7021),a(6839)),c=a(7841),d=a(3932),u=a(1273),h=(a(9971),a(5975)),m=a(579);const p=e=>{let{id:t,title:a="",content:p="",onSavePost:f,onUploadImage:g}=e;const[v,j]=(0,l.useState)(a),[x,b]=(0,l.useState)(!1),[y,S]=(0,l.useState)(""),[,w]=(0,l.useState)(""),[T,P]=(0,l.useState)(p),[k,A]=(0,l.useState)([]),[C,E]=(0,l.useState)(!1),[U,I]=(0,l.useState)(!1),[_,H]=(0,l.useState)({});const[D,O]=(0,l.useState)(!1);var[F]=(0,h.A)();return(0,l.useEffect)((()=>{t&&(j(a),F.setFieldValue("title",a),P(p))}),[t]),(0,m.jsxs)("div",{className:"container py-5 text-center",children:[(0,m.jsxs)(d.EbayAlertDialog,{open:C,confirmText:"\u53bb\u8865\u5145",onConfirm:()=>{E(!1)},a11yClosetext:"Close",children:[(0,m.jsx)(u.EbayDialogHeader,{children:"\u8bf7\u8f93\u5165\u5b8c\u6574\u5b57\u6bb5"}),(0,m.jsx)("p",{children:"\u6240\u6709\u5b57\u6bb5\u5747\u4e3a\u5fc5\u586b\u9879"})]}),(0,m.jsxs)(d.EbayAlertDialog,{open:U,confirmText:"\u8df3\u8f6c\u5230\u6587\u7ae0\u5217\u8868",onConfirm:()=>{window.location.href="/post/".concat(_.id)},a11yClosetext:"Close",children:[(0,m.jsx)(u.EbayDialogHeader,{children:"\u4fdd\u5b58\u6210\u529f\ud83c\udf89"}),(0,m.jsx)("p",{children:"\u4fdd\u5b58\u6210\u529f\uff0c\u70b9\u51fb\u5230\u6587\u7ae0\u5217\u8868\u67e5\u770b\u6240\u6709\u6587\u7ae0\u3002"})]}),(0,m.jsxs)(n.A,{className:"post-form",name:"basic",initialValues:{remember:!0},onFinish:async()=>{if(T){O(!0);var e=await f(t,v,"todo",T);e&&e.id&&(I(!0),H(e))}else E(!0)},onFinishFailed:()=>{E(!0)},autoComplete:"off",form:F,children:[(0,m.jsx)("div",{children:(0,m.jsx)(n.A.Item,{label:"\u6807\u9898",name:"title",rules:[{required:!0,message:"Please input your title!"}],children:(0,m.jsx)(s.A,{value:v,onChange:function(e){j(e.target.value)},placeHolder:"\u8bf7\u8f93\u5165\u6587\u7ae0\u6807\u9898..."})})}),(0,m.jsx)("div",{style:{display:"none"},children:(0,m.jsx)(n.A.Item,{label:"\u5c01\u9762",name:"cover",children:(0,m.jsxs)("div",{className:"cover",children:[(0,m.jsx)(i.A,{listType:"picture-card",fileList:k,onPreview:function(e){S(e.thumbUrl),b(!0)},onChange:function(e){let{fileList:t}=e;var a;A(t),t.length>0&&(a=t[0].originFileObj,new Promise(((e,t)=>{const n=new FileReader;n.readAsDataURL(a),n.onload=()=>e(n.result),n.onerror=e=>t(e)}))).then((e=>{w(e)}))},children:k.length<1&&"+ \u4e0a\u4f20\u5c01\u9762"}),(0,m.jsx)(o.A,{visible:x,title:"Preview",footer:null,onCancel:function(){b(!1)},children:(0,m.jsx)("img",{alt:"Preview",style:{width:"100%"},src:y})})]})})}),(0,m.jsx)("div",{children:(0,m.jsx)(r.K,{value:T,apiKey:"2jhvkjrvlnoj8ak334n2tzi6n3ltegj0pl128h3lhd0s4bpo",initialValue:"<p>This is the initial content of the editor</p>",init:{language:"zh-Hans",language_url:"../../../zh-Hans.js",menubar:!0,height:500,images_upload_handler:g,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table paste code help wordcount","image"],toolbar:"undo redo | formatselect | bold italic backcolor |             alignleft aligncenter alignright alignjustify |             bullist numlist outdent indent | removeformat | help |             image"},onEditorChange:function(e){P(e)}})}),(0,m.jsx)("div",{className:"saveBtn",children:(0,m.jsx)(c.EbayButton,{disabled:D,htmlType:"submit",priority:"primary",children:"\u4fdd\u5b58"})})]})]})};var f=a(2693),g=a(6543),v=a(8693),j=a(3216);const x=()=>{const[e,t]=(0,l.useState)({id:"",title:"","cover-image":"",content:""}),{id:a}=(0,j.g)();return(0,l.useEffect)((()=>{(async()=>{if(a){const e=await(0,f.J)(g.B.POST_URI,[{key:"useMock",value:"true"},{key:"id",value:a}]);t(e)}})()}),[]),{post:e}},b=()=>{const{post:e}=x();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(v.A,{activeIndex:"post"}),(0,m.jsx)(p,{...e,onSavePost:async(e,t,a,n)=>{var s={title:t,"cover-image":"todo",content:n};return e&&(s.id=e),await(0,f.U)(e?g.B.POST_UPDATE_URI:g.B.POST_SAVE_URI,[{key:"useMock",value:"true"}],s)},onUploadImage:(e,t)=>new Promise(((a,n)=>{const s=new XMLHttpRequest;s.withCredentials=!1,s.open("POST","".concat(g.vd+g.B.POST_UPLOAD_IMAGE,"?fileName=").concat((new Date).getTime(),".jpeg")),s.setRequestHeader("luso_token","c6c54ce4-dc21-4e87-bdab-482dc6f0c96b"),s.upload.onprogress=()=>{},s.onload=()=>{if(403===s.status)return void n({message:"HTTP Error: "+s.status,remove:!0});if(s.status<200||s.status>=300)return void n("HTTP Error: "+s.status);const e=JSON.parse(s.responseText);e&&"string"==typeof e.thumbUrl?(t(e.thumbUrl),a()):n("Invalid JSON: "+s.responseText)},s.onerror=()=>{n("Image upload failed due to a XHR Transport error. Code: "+s.status)};const i=new FormData;i.append("file",e.blob()),s.send(i)}))})]})}},7021:()=>{}}]);
//# sourceMappingURL=974.b9630877.chunk.js.map