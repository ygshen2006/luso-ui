{"version":3,"file":"static/js/943.cf52b55d.chunk.js","mappings":"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","sources":["components/Admin/posts/PostEditView.jsx","components/Admin/posts/PostEditHook.jsx","components/Admin/posts/PostEditContainer.jsx"],"sourcesContent":["import { Form, Input, Upload, Modal } from \"antd\";\nimport { useEffect, useState } from \"react\";\nimport \"./style.css\";\nimport { Editor } from \"@tinymce/tinymce-react\";\nimport { EbayButton } from \"@ebay/ui-core-react/ebay-button\";\nimport { EbayAlertDialog } from \"@ebay/ui-core-react/ebay-alert-dialog\";\nimport { EbayDialogHeader } from \"@ebay/ui-core-react/ebay-dialog-base\";\n\nimport \"@ebay/skin\";\nimport { useForm } from \"antd/es/form/Form\";\n\nconst PostEditView = ({\n  id,\n  title = \"\",\n  content = \"\",\n  onSavePost,\n  onUploadImage,\n}) => {\n  const onFinish = async () => {\n    if (!editorValue) {\n      setErrorDialogVisible(true);\n      return;\n    }\n    setSaveDisabled(true);\n    var result = await onSavePost(id, postTitle, \"todo\", editorValue);\n    if (result && result.id) {\n      setSuccessDialogVisible(true);\n      setSavedPost(result);\n    }\n  };\n\n  const onFinishFailed = () => {\n    setErrorDialogVisible(true);\n  };\n  const [postTitle, setPostTitle] = useState(title);\n  const [previewVisible, setPreviewVisible] = useState(false);\n  const [previewImage, setPreviewImage] = useState(\"\");\n  const [, setCoverImageBase64] = useState(\"\");\n  const [editorValue, setEditorContent] = useState(content);\n  const [fileList, setFileList] = useState([]);\n  const [errorDialogVisible, setErrorDialogVisible] = useState(false);\n  const [successDialogVisible, setSuccessDialogVisible] = useState(false);\n  const [savedPost, setSavedPost] = useState({});\n  function handleCancel() {\n    setPreviewVisible(false);\n  }\n\n  function handlePreview(file) {\n    setPreviewImage(file.thumbUrl);\n    setPreviewVisible(true);\n  }\n\n  function handleChange({ fileList: newFileList }) {\n    setFileList(newFileList);\n    if (newFileList.length > 0) {\n      getBase64(newFileList[0].originFileObj).then((data) => {\n        setCoverImageBase64(data);\n      });\n    }\n  }\n\n  function handleTitleChange(e) {\n    setPostTitle(e.target.value);\n  }\n  function handleEditorChange(content) {\n    setEditorContent(content);\n  }\n\n  const [saveDisabled, setSaveDisabled] = useState(false);\n  function getBase64(file) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n      reader.onload = () => resolve(reader.result);\n      reader.onerror = (error) => reject(error);\n    });\n  }\n\n  var [form] = useForm();\n  useEffect(() => {\n    if (id) {\n      setPostTitle(title);\n      form.setFieldValue(\"title\", title);\n      setEditorContent(content);\n    }\n  }, [id]);\n  return (\n    <div className=\"container py-5 text-center\">\n      <EbayAlertDialog\n        open={errorDialogVisible}\n        confirmText=\"去补充\"\n        onConfirm={() => {\n          setErrorDialogVisible(false);\n        }}\n        a11yClosetext=\"Close\"\n      >\n        <EbayDialogHeader>请输入完整字段</EbayDialogHeader>\n        <p>所有字段均为必填项</p>\n      </EbayAlertDialog>\n\n      <EbayAlertDialog\n        open={successDialogVisible}\n        confirmText=\"跳转到文章列表\"\n        onConfirm={() => {\n          window.location.href = `/post/${savedPost.id}`;\n        }}\n        a11yClosetext=\"Close\"\n      >\n        <EbayDialogHeader>保存成功🎉</EbayDialogHeader>\n        <p>保存成功，点击到文章列表查看所有文章。</p>\n      </EbayAlertDialog>\n      <Form\n        className=\"post-form\"\n        name=\"basic\"\n        initialValues={{\n          remember: true,\n        }}\n        onFinish={onFinish}\n        onFinishFailed={onFinishFailed}\n        autoComplete=\"off\"\n        form={form}\n      >\n        <div>\n          <Form.Item\n            label=\"标题\"\n            name=\"title\"\n            rules={[\n              {\n                required: true,\n                message: \"Please input your title!\",\n              },\n            ]}\n          >\n            <Input\n              value={postTitle}\n              onChange={handleTitleChange}\n              placeHolder=\"请输入文章标题...\"\n            />\n          </Form.Item>\n        </div>\n\n        <div style={{ display: \"none\" }}>\n          <Form.Item label=\"封面\" name=\"cover\">\n            <div className=\"cover\">\n              <Upload\n                listType=\"picture-card\"\n                fileList={fileList}\n                onPreview={handlePreview}\n                onChange={handleChange}\n              >\n                {fileList.length < 1 && \"+ 上传封面\"}\n              </Upload>\n              <Modal\n                visible={previewVisible}\n                title=\"Preview\"\n                footer={null}\n                onCancel={handleCancel}\n              >\n                <img\n                  alt=\"Preview\"\n                  style={{ width: \"100%\" }}\n                  src={previewImage}\n                />\n              </Modal>\n            </div>\n          </Form.Item>\n        </div>\n\n        <div>\n          <Editor\n            value={editorValue}\n            apiKey=\"2jhvkjrvlnoj8ak334n2tzi6n3ltegj0pl128h3lhd0s4bpo\"\n            initialValue=\"<p>This is the initial content of the editor</p>\"\n            init={{\n              language: \"zh-Hans\",\n              language_url: \"../../../zh-Hans.js\",\n              menubar: true,\n              height: 500,\n              images_upload_handler: onUploadImage,\n              plugins: [\n                \"advlist autolink lists link image charmap print preview anchor\",\n                \"searchreplace visualblocks code fullscreen\",\n                \"insertdatetime media table paste code help wordcount\",\n                \"image\",\n              ],\n              toolbar:\n                \"undo redo | formatselect | bold italic backcolor | \\\n            alignleft aligncenter alignright alignjustify | \\\n            bullist numlist outdent indent | removeformat | help | \\\n            image\",\n            }}\n            onEditorChange={handleEditorChange}\n          />\n        </div>\n\n        <div className=\"saveBtn\">\n          <EbayButton\n            disabled={saveDisabled}\n            htmlType=\"submit\"\n            priority=\"primary\"\n          >\n            保存\n          </EbayButton>\n        </div>\n      </Form>\n    </div>\n  );\n};\n\nexport default PostEditView;\n","import { useEffect, useState } from \"react\";\nimport { useParams } from \"react-router\";\nimport { get } from \"utils/api\";\nimport { AdminConstants } from \"utils/constants\";\n\nconst usePostEdit = () => {\n  const [post, setPost] = useState({\n    id: \"\",\n    title: \"\",\n    \"cover-image\": \"\",\n    content: \"\",\n  });\n\n  const { id } = useParams();\n\n  useEffect(() => {\n    const fetchData = async () => {\n      if (id) {\n        const result = await get(AdminConstants.POST_URI, [\n          {\n            key: \"useMock\",\n            value: \"true\",\n          },\n          {\n            key: \"id\",\n            value: id,\n          },\n        ]);\n\n        setPost(result);\n      }\n    };\n    fetchData();\n  }, []);\n\n  return { post };\n};\n\nexport default usePostEdit;\n","import PostEditView from \"./PostEditView\";\nimport { save } from \"utils/api\";\nimport { AdminConstants, REMOTE_URL } from \"utils/constants\";\nimport TopNav from \"components/Others/Head/TopNav\";\nimport usePostEdit from \"./PostEditHook\";\n\nconst PostEditContainer = () => {\n  const { post } = usePostEdit();\n\n  const savePost = async (id, title, coverImage, content) => {\n    var body = {\n      title,\n      \"cover-image\": \"todo\",\n      content,\n    };\n    if (id) {\n      body.id = id;\n    }\n    var result = await save(\n      !id ? AdminConstants.POST_SAVE_URI : AdminConstants.POST_UPDATE_URI,\n      [\n        {\n          key: \"useMock\",\n          value: \"true\",\n        },\n      ],\n      body,\n    );\n\n    return result;\n  };\n\n  const uploadImage = (blobInfo, progress) =>\n    new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.withCredentials = false;\n      xhr.open(\n        \"POST\",\n        `${\n          REMOTE_URL + AdminConstants.POST_UPLOAD_IMAGE\n        }?fileName=${new Date().getTime()}.jpeg`,\n      );\n\n      xhr.setRequestHeader(\n        \"luso_token\",\n        \"c6c54ce4-dc21-4e87-bdab-482dc6f0c96b\",\n      );\n\n      xhr.upload.onprogress = () => {};\n\n      xhr.onload = () => {\n        if (xhr.status === 403) {\n          reject({ message: \"HTTP Error: \" + xhr.status, remove: true });\n          return;\n        }\n\n        if (xhr.status < 200 || xhr.status >= 300) {\n          reject(\"HTTP Error: \" + xhr.status);\n          return;\n        }\n\n        const json = JSON.parse(xhr.responseText);\n\n        if (!json || typeof json.thumbUrl != \"string\") {\n          reject(\"Invalid JSON: \" + xhr.responseText);\n          return;\n        }\n\n        progress(json.thumbUrl);\n        resolve();\n      };\n\n      xhr.onerror = () => {\n        reject(\n          \"Image upload failed due to a XHR Transport error. Code: \" +\n            xhr.status,\n        );\n      };\n\n      const formData = new FormData();\n      formData.append(\"file\", blobInfo.blob());\n\n      xhr.send(formData);\n    });\n  return (\n    <>\n      <TopNav activeIndex=\"post\" />\n      <PostEditView\n        {...post}\n        onSavePost={savePost}\n        onUploadImage={uploadImage}\n      />\n    </>\n  );\n};\n\nexport default PostEditContainer;\n"],"names":["_ref","id","title","content","onSavePost","onUploadImage","postTitle","setPostTitle","useState","previewVisible","setPreviewVisible","previewImage","setPreviewImage","setCoverImageBase64","editorValue","setEditorContent","fileList","setFileList","errorDialogVisible","setErrorDialogVisible","successDialogVisible","setSuccessDialogVisible","savedPost","setSavedPost","saveDisabled","setSaveDisabled","form","useForm","useEffect","setFieldValue","_jsxs","className","children","EbayAlertDialog","open","confirmText","onConfirm","a11yClosetext","_jsx","EbayDialogHeader","window","location","href","concat","Form","name","initialValues","remember","onFinish","async","result","onFinishFailed","autoComplete","Item","label","rules","required","message","Input","value","onChange","e","target","placeHolder","style","display","Upload","listType","onPreview","file","thumbUrl","_ref2","newFileList","length","originFileObj","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","onerror","error","then","data","Modal","visible","footer","onCancel","alt","width","src","Editor","apiKey","initialValue","init","language","language_url","menubar","height","images_upload_handler","plugins","toolbar","onEditorChange","EbayButton","disabled","htmlType","priority","usePostEdit","post","setPost","useParams","get","AdminConstants","POST_URI","key","fetchData","PostEditContainer","_Fragment","TopNav","activeIndex","PostEditView","coverImage","body","save","POST_UPDATE_URI","POST_SAVE_URI","uploadImage","blobInfo","progress","xhr","XMLHttpRequest","withCredentials","REMOTE_URL","POST_UPLOAD_IMAGE","Date","getTime","setRequestHeader","upload","onprogress","status","remove","json","JSON","parse","responseText","formData","FormData","append","blob","send"],"sourceRoot":""}